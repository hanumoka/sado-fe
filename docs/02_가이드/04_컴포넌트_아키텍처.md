# 컴포넌트 아키텍처

> **Feature-based 구조 (2025 권장)**

---

## 개요

### Feature-based 구조란?

기능(Feature) 단위로 관련 파일을 그룹화하는 폴더 구조입니다.

**장점**:
- 관련 코드가 한 곳에 모임
- 독립적인 기능 개발 가능
- 확장성 우수
- 코드 탐색 용이

**vs 전통적 Layer-based**:
```
# Layer-based (비권장)
src/
├── components/    # 모든 컴포넌트
├── hooks/         # 모든 훅
├── services/      # 모든 서비스
└── types/         # 모든 타입

# Feature-based (권장)
src/
├── features/
│   ├── auth/      # 인증 관련 모든 것
│   ├── study/     # 스터디 관련 모든 것
│   └── upload/    # 업로드 관련 모든 것
└── components/    # 공용 컴포넌트만
```

---

## 폴더 구조

### 전체 구조

```
src/
├── app/                       # 앱 레벨 설정
│   ├── App.tsx
│   ├── Router.tsx
│   └── providers.tsx
│
├── features/                  # 기능별 모듈
│   ├── auth/                  # 인증
│   │   ├── components/
│   │   │   ├── LoginButton.tsx
│   │   │   └── UserMenu.tsx
│   │   ├── hooks/
│   │   │   └── useAuth.ts
│   │   ├── stores/
│   │   │   └── authStore.ts
│   │   ├── types/
│   │   │   └── auth.ts
│   │   └── index.ts           # 퍼블릭 API
│   │
│   ├── study/                 # 스터디 관리
│   │   ├── components/
│   │   │   ├── StudyList.tsx
│   │   │   ├── StudyCard.tsx
│   │   │   ├── StudyDetail.tsx
│   │   │   └── StudyFilters.tsx
│   │   ├── hooks/
│   │   │   ├── useStudies.ts
│   │   │   └── useStudy.ts
│   │   ├── types/
│   │   │   └── study.ts
│   │   └── index.ts
│   │
│   ├── upload/                # DICOM 업로드
│   │   ├── components/
│   │   │   ├── UploadDropzone.tsx
│   │   │   ├── UploadProgress.tsx
│   │   │   └── UploadResult.tsx
│   │   ├── hooks/
│   │   │   └── useUpload.ts
│   │   ├── types/
│   │   │   └── upload.ts
│   │   └── index.ts
│   │
│   ├── dicom-viewer/          # DICOM 뷰어
│   │   ├── components/
│   │   │   ├── DicomViewer.tsx
│   │   │   ├── ViewerToolbar.tsx
│   │   │   └── ViewerControls.tsx
│   │   ├── hooks/
│   │   │   └── useViewer.ts
│   │   ├── types/
│   │   │   └── viewer.ts
│   │   └── index.ts
│   │
│   └── analysis/              # AI 분석
│       ├── components/
│       │   ├── AnalysisResult.tsx
│       │   ├── EFDisplay.tsx
│       │   └── SegmentationOverlay.tsx
│       ├── hooks/
│       │   └── useAnalysis.ts
│       ├── types/
│       │   └── analysis.ts
│       └── index.ts
│
├── components/                # 공용 컴포넌트
│   ├── ui/                    # shadcn/ui 컴포넌트
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── dialog.tsx
│   │   └── ...
│   ├── layout/                # 레이아웃 컴포넌트
│   │   ├── Header.tsx
│   │   ├── Sidebar.tsx
│   │   ├── MainContent.tsx
│   │   └── Layout.tsx
│   └── common/                # 공용 UI 컴포넌트
│       ├── LoadingSpinner.tsx
│       ├── ErrorBoundary.tsx
│       └── EmptyState.tsx
│
├── hooks/                     # 공용 훅
│   ├── useLocalStorage.ts
│   ├── useDebounce.ts
│   └── useMediaQuery.ts
│
├── lib/                       # 유틸리티
│   ├── utils.ts               # cn() 등
│   ├── api.ts                 # API 클라이언트
│   ├── queryClient.ts         # TanStack Query
│   └── constants.ts           # 상수
│
├── stores/                    # 전역 스토어
│   └── uiStore.ts             # UI 상태
│
├── types/                     # 전역 타입
│   ├── api.ts
│   └── common.ts
│
├── assets/                    # 정적 자산
│   ├── images/
│   └── icons/
│
├── main.tsx                   # 엔트리 포인트
└── index.css                  # 글로벌 스타일
```

---

## Feature 모듈 패턴

### 기본 구조

```
features/study/
├── components/       # UI 컴포넌트
├── hooks/            # 커스텀 훅
├── stores/           # 상태 (필요시)
├── types/            # 타입 정의
├── utils/            # 유틸리티 (필요시)
└── index.ts          # 퍼블릭 API
```

### index.ts (Barrel Export)

```typescript
// features/study/index.ts

// 컴포넌트
export { StudyList } from './components/StudyList';
export { StudyCard } from './components/StudyCard';
export { StudyDetail } from './components/StudyDetail';

// 훅
export { useStudies, useStudy } from './hooks/useStudies';

// 타입
export type { Study, StudyFilters, StudyStatus } from './types/study';
```

### 사용 예시

```typescript
// 외부에서 import
import { StudyList, useStudies, type Study } from '@/features/study';
```

---

## 컴포넌트 설계 원칙

### 1. 단일 책임 원칙

```typescript
// BAD: 하나의 컴포넌트가 너무 많은 일을 함
function StudyPage() {
  // 데이터 페칭, 필터링, 렌더링 모두 포함
}

// GOOD: 책임 분리
function StudyPage() {
  return (
    <Layout>
      <StudyFilters />
      <StudyList />
    </Layout>
  );
}
```

### 2. 컨테이너/프레젠테이션 분리

```typescript
// Container: 로직 담당
function StudyListContainer() {
  const { data, isLoading } = useStudies();

  if (isLoading) return <Skeleton />;

  return <StudyList studies={data} />;
}

// Presentation: UI 담당
function StudyList({ studies }: { studies: Study[] }) {
  return (
    <ul>
      {studies.map(study => (
        <StudyCard key={study.id} study={study} />
      ))}
    </ul>
  );
}
```

### 3. Composition over Inheritance

```typescript
// GOOD: 합성 사용
function Card({ children, header, footer }: CardProps) {
  return (
    <div className="card">
      {header && <div className="card-header">{header}</div>}
      <div className="card-body">{children}</div>
      {footer && <div className="card-footer">{footer}</div>}
    </div>
  );
}

// 사용
<Card
  header={<h2>Study Info</h2>}
  footer={<Button>Analyze</Button>}
>
  <StudyDetail study={study} />
</Card>
```

---

## 컴포넌트 작성 템플릿

### 기본 컴포넌트

```typescript
// features/study/components/StudyCard.tsx
import { cn } from '@/lib/utils';
import { Card, CardHeader, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import type { Study } from '../types/study';

interface StudyCardProps {
  study: Study;
  className?: string;
  onClick?: (study: Study) => void;
}

export function StudyCard({ study, className, onClick }: StudyCardProps) {
  return (
    <Card
      className={cn('cursor-pointer hover:shadow-md', className)}
      onClick={() => onClick?.(study)}
    >
      <CardHeader>
        <div className="flex items-center justify-between">
          <h3 className="font-medium">{study.patientName}</h3>
          <Badge variant={study.status === 'analyzed' ? 'success' : 'default'}>
            {study.status}
          </Badge>
        </div>
      </CardHeader>
      <CardContent>
        <p className="text-sm text-muted-foreground">
          {new Date(study.studyDate).toLocaleDateString()}
        </p>
      </CardContent>
    </Card>
  );
}
```

### 데이터 페칭 컴포넌트

```typescript
// features/study/components/StudyList.tsx
import { useStudies } from '../hooks/useStudies';
import { StudyCard } from './StudyCard';
import { Skeleton } from '@/components/ui/skeleton';
import { EmptyState } from '@/components/common/EmptyState';

interface StudyListProps {
  filters?: StudyFilters;
  onStudyClick?: (study: Study) => void;
}

export function StudyList({ filters, onStudyClick }: StudyListProps) {
  const { data: studies, isLoading, error } = useStudies(filters);

  if (isLoading) {
    return (
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {Array.from({ length: 6 }).map((_, i) => (
          <Skeleton key={i} className="h-32" />
        ))}
      </div>
    );
  }

  if (error) {
    return <div className="text-red-500">Error: {error.message}</div>;
  }

  if (!studies?.length) {
    return <EmptyState message="No studies found" />;
  }

  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {studies.map(study => (
        <StudyCard
          key={study.id}
          study={study}
          onClick={onStudyClick}
        />
      ))}
    </div>
  );
}
```

---

## 타입 정의

### Feature 타입

```typescript
// features/study/types/study.ts

export interface Study {
  id: string;
  patientId: string;
  patientName: string;
  studyDate: string;
  modality: string;
  status: StudyStatus;
  seriesCount: number;
  instanceCount: number;
  createdAt: string;
  updatedAt: string;
}

export type StudyStatus =
  | 'PENDING'
  | 'UPLOADING'
  | 'ANALYZING'
  | 'COMPLETED'
  | 'FAILED';

export interface StudyFilters {
  patientName?: string;
  dateFrom?: string;
  dateTo?: string;
  status?: StudyStatus;
  page?: number;
  size?: number;
}

export interface StudyWithAnalysis extends Study {
  analysis: AnalysisResult | null;
}
```

### API 응답 타입

```typescript
// types/api.ts

export interface ApiResponse<T> {
  data: T;
  status: number;
  message: string;
}

export interface PaginatedResponse<T> {
  content: T[];
  totalElements: number;
  totalPages: number;
  page: number;
  size: number;
}
```

---

## 경로 별칭

### vite.config.ts

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

### tsconfig.json

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

### Import 예시

```typescript
// 절대 경로 사용
import { Button } from '@/components/ui/button';
import { useStudies } from '@/features/study';
import { api } from '@/lib/api';
```

---

## 네이밍 규칙

| 대상 | 규칙 | 예시 |
|-----|------|------|
| 컴포넌트 파일 | PascalCase | `StudyList.tsx` |
| 컴포넌트 함수 | PascalCase | `function StudyList()` |
| 훅 파일 | camelCase | `useStudies.ts` |
| 훅 함수 | camelCase, use 접두사 | `function useStudies()` |
| 타입 파일 | camelCase | `study.ts` |
| 타입/인터페이스 | PascalCase | `interface Study` |
| 상수 | SCREAMING_SNAKE | `const API_BASE_URL` |
| 유틸리티 | camelCase | `formatDate.ts` |

---

## 참고 자료

- [React Folder Structure in 2025](https://www.robinwieruch.de/react-folder-structure/)
- [Feature-Sliced Design](https://feature-sliced.design/)
- [Bulletproof React](https://github.com/alan2207/bulletproof-react)

---

*최종 수정: 2025-12-25*
